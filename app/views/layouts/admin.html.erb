<!DOCTYPE html>
<html lang="en">
  <head>
    <title><%= t("admin.title_prefix") %> - <%= content_for(:title) || t("site.name") %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <link rel="preconnect" href="https://rsms.me/">
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">

    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>

    <%= yield :head %>
  </head>

  <body class="min-h-screen bg-background font-sans antialiased">
    <div class="relative flex min-h-screen">
      <%# Desktop Sidebar %>
      <aside class="hidden lg:flex lg:flex-col lg:w-64 lg:fixed lg:inset-y-0 bg-card border-r border-border">
        <%# Header %>
        <div class="flex h-16 items-center gap-3 px-6">
          <%= link_to admin_root_path, class: "flex items-center" do %>
            <%= image_tag "/logo.png", class: "h-10 w-auto rounded-lg" %>
          <% end %>
        </div>

        <%# Navigation %>
        <nav class="flex-1 px-4 py-6 space-y-1 overflow-y-auto">
          <%= link_to admin_root_path, class: "flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg transition-colors #{current_page?(admin_root_path) ? 'bg-primary/10 text-primary' : 'text-muted-foreground hover:text-foreground hover:bg-muted'}" do %>
            <%= icon :layout_dashboard, size: 18 %>
            Dashboard
          <% end %>

          <div class="pt-4 pb-2">
            <span class="px-3 text-xs font-semibold uppercase tracking-wider text-muted-foreground/60">Content</span>
          </div>
          
          <%= link_to admin_users_path, class: "flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg transition-colors #{request.path.include?('users') ? 'bg-primary/10 text-primary' : 'text-muted-foreground hover:text-foreground hover:bg-muted'}" do %>
            <%= icon :users, size: 18 %>
            Users
          <% end %>
          <%= link_to admin_campaigns_path, class: "flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg transition-colors #{request.path.include?('campaigns') ? 'bg-primary/10 text-primary' : 'text-muted-foreground hover:text-foreground hover:bg-muted'}" do %>
            <%= icon :flag, size: 18 %>
            Campaigns
          <% end %>
          <%= link_to admin_referrals_path, class: "flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg transition-colors #{request.path.include?('referrals') && !request.path.include?('referral_sources') ? 'bg-primary/10 text-primary' : 'text-muted-foreground hover:text-foreground hover:bg-muted'}" do %>
            <%= icon :link, size: 18 %>
            Referrals
          <% end %>
          <%= link_to admin_referral_sources_path, class: "flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg transition-colors #{request.path.include?('referral_sources') ? 'bg-primary/10 text-primary' : 'text-muted-foreground hover:text-foreground hover:bg-muted'}" do %>
            <%= icon :external_link, size: 18 %>
            Referral Sources
          <% end %>
          <%= link_to admin_posters_path, class: "flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg transition-colors #{request.path.include?('posters') ? 'bg-primary/10 text-primary' : 'text-muted-foreground hover:text-foreground hover:bg-muted'}" do %>
            <%= icon :qr_code, size: 18 %>
            Posters
          <% end %>
          <%= link_to admin_video_submissions_path, class: "flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg transition-colors #{request.path.include?('video_submissions') ? 'bg-primary/10 text-primary' : 'text-muted-foreground hover:text-foreground hover:bg-muted'}" do %>
            <%= icon :video, size: 18 %>
            Videos
          <% end %>

          <div class="pt-4 pb-2">
            <span class="px-3 text-xs font-semibold uppercase tracking-wider text-muted-foreground/60">Analytics</span>
          </div>

          <%= link_to admin_statistics_path, class: "flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg transition-colors #{request.path.include?('statistics') ? 'bg-primary/10 text-primary' : 'text-muted-foreground hover:text-foreground hover:bg-muted'}" do %>
            <%= icon :bar_chart_2, size: 18 %>
            Statistics
          <% end %>
          <%= link_to admin_progress_path, class: "flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg transition-colors #{request.path.include?('progress') ? 'bg-primary/10 text-primary' : 'text-muted-foreground hover:text-foreground hover:bg-muted'}" do %>
            <%= icon :trending_up, size: 18 %>
            Progress
          <% end %>
          <%= link_to admin_geo_path, class: "flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg transition-colors #{request.path.include?('geo') ? 'bg-primary/10 text-primary' : 'text-muted-foreground hover:text-foreground hover:bg-muted'}" do %>
            <%= icon :globe, size: 18 %>
            Geographic
          <% end %>

          <div class="pt-4 pb-2">
            <span class="px-3 text-xs font-semibold uppercase tracking-wider text-muted-foreground/60">Commerce</span>
          </div>

          <%= link_to admin_shop_items_path, class: "flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg transition-colors #{request.path.include?('shop_items') ? 'bg-primary/10 text-primary' : 'text-muted-foreground hover:text-foreground hover:bg-muted'}" do %>
            <%= icon :shopping_bag, size: 18 %>
            Shop Items
          <% end %>
          <%= link_to admin_shop_orders_path, class: "flex items-center gap-3 px-3 py-2.5 text-sm font-medium rounded-lg transition-colors #{request.path.include?('shop_orders') ? 'bg-primary/10 text-primary' : 'text-muted-foreground hover:text-foreground hover:bg-muted'}" do %>
            <%= icon :package, size: 18 %>
            Orders
          <% end %>
        </nav>

        <%# Footer %>
        <div class="px-4 py-4 border-t border-border">
          <%= link_to root_path, class: "flex items-center justify-center gap-2 w-full px-4 py-2.5 text-sm font-medium rounded-lg bg-muted text-foreground hover:bg-muted/80 transition-colors" do %>
            <%= icon :arrow_left, size: 16 %>
            Exit Admin
          <% end %>
        </div>
      </aside>

      <%# Main content area %>
      <div class="flex-1 lg:pl-64">
        <%# Mobile/Tablet Header %>
        <nav class="lg:hidden sticky top-0 z-50 w-full border-b border-border bg-card" data-controller="admin-mobile-menu">
          <div class="flex h-14 items-center justify-between px-4">
            <%= link_to admin_root_path, class: "flex items-center" do %>
              <%= image_tag "/logo.png", class: "h-8 w-auto rounded-lg" %>
            <% end %>

            <button type="button"
                    data-action="click->admin-mobile-menu#toggle"
                    data-admin-mobile-menu-target="button"
                    class="inline-flex items-center justify-center p-2 rounded-lg text-foreground hover:bg-muted transition-colors">
              <span data-admin-mobile-menu-target="openIcon"><%= icon :menu, size: 22 %></span>
              <span data-admin-mobile-menu-target="closeIcon" class="hidden"><%= icon :x, size: 22 %></span>
            </button>
          </div>

          <%# Mobile Menu %>
          <div data-admin-mobile-menu-target="menu" class="hidden border-t border-border bg-card">
            <div class="px-4 py-4 space-y-1">
              <%= link_to admin_root_path, class: "flex items-center gap-3 text-sm font-medium #{current_page?(admin_root_path) ? 'text-primary bg-primary/10' : 'text-muted-foreground hover:text-foreground hover:bg-muted'} transition-colors py-2.5 px-3 rounded-lg" do %>
                <%= icon :layout_dashboard, size: 18 %>
                Dashboard
              <% end %>
              <%= link_to admin_users_path, class: "flex items-center gap-3 text-sm font-medium #{request.path.include?('users') ? 'text-primary bg-primary/10' : 'text-muted-foreground hover:text-foreground hover:bg-muted'} transition-colors py-2.5 px-3 rounded-lg" do %>
                <%= icon :users, size: 18 %>
                Users
              <% end %>
              <%= link_to admin_campaigns_path, class: "flex items-center gap-3 text-sm font-medium #{request.path.include?('campaigns') ? 'text-primary bg-primary/10' : 'text-muted-foreground hover:text-foreground hover:bg-muted'} transition-colors py-2.5 px-3 rounded-lg" do %>
                <%= icon :flag, size: 18 %>
                Campaigns
              <% end %>
              <%= link_to admin_referrals_path, class: "flex items-center gap-3 text-sm font-medium #{request.path.include?('referrals') ? 'text-primary bg-primary/10' : 'text-muted-foreground hover:text-foreground hover:bg-muted'} transition-colors py-2.5 px-3 rounded-lg" do %>
                <%= icon :link, size: 18 %>
                Referrals
              <% end %>
              <%= link_to admin_posters_path, class: "flex items-center gap-3 text-sm font-medium #{request.path.include?('posters') ? 'text-primary bg-primary/10' : 'text-muted-foreground hover:text-foreground hover:bg-muted'} transition-colors py-2.5 px-3 rounded-lg" do %>
                <%= icon :qr_code, size: 18 %>
                Posters
              <% end %>
              <%= link_to admin_video_submissions_path, class: "flex items-center gap-3 text-sm font-medium #{request.path.include?('video_submissions') ? 'text-primary bg-primary/10' : 'text-muted-foreground hover:text-foreground hover:bg-muted'} transition-colors py-2.5 px-3 rounded-lg" do %>
                <%= icon :video, size: 18 %>
                Videos
              <% end %>
              <%= link_to admin_statistics_path, class: "flex items-center gap-3 text-sm font-medium #{request.path.include?('statistics') ? 'text-primary bg-primary/10' : 'text-muted-foreground hover:text-foreground hover:bg-muted'} transition-colors py-2.5 px-3 rounded-lg" do %>
                <%= icon :bar_chart_2, size: 18 %>
                Statistics
              <% end %>
              <%= link_to admin_progress_path, class: "flex items-center gap-3 text-sm font-medium #{request.path.include?('progress') ? 'text-primary bg-primary/10' : 'text-muted-foreground hover:text-foreground hover:bg-muted'} transition-colors py-2.5 px-3 rounded-lg" do %>
                <%= icon :trending_up, size: 18 %>
                Progress
              <% end %>
              <%= link_to admin_geo_path, class: "flex items-center gap-3 text-sm font-medium #{request.path.include?('geo') ? 'text-primary bg-primary/10' : 'text-muted-foreground hover:text-foreground hover:bg-muted'} transition-colors py-2.5 px-3 rounded-lg" do %>
                <%= icon :globe, size: 18 %>
                Geographic
              <% end %>
              <%= link_to admin_shop_items_path, class: "flex items-center gap-3 text-sm font-medium #{request.path.include?('shop_items') ? 'text-primary bg-primary/10' : 'text-muted-foreground hover:text-foreground hover:bg-muted'} transition-colors py-2.5 px-3 rounded-lg" do %>
                <%= icon :shopping_bag, size: 18 %>
                Shop Items
              <% end %>
              <%= link_to admin_shop_orders_path, class: "flex items-center gap-3 text-sm font-medium #{request.path.include?('shop_orders') ? 'text-primary bg-primary/10' : 'text-muted-foreground hover:text-foreground hover:bg-muted'} transition-colors py-2.5 px-3 rounded-lg" do %>
                <%= icon :package, size: 18 %>
                Orders
              <% end %>
              
              <div class="border-t border-border pt-3 mt-3">
                <%= link_to root_path, class: "flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-medium bg-muted text-foreground rounded-lg hover:bg-muted/80 transition-colors" do %>
                  <%= icon :arrow_left, size: 16 %>
                  Exit Admin
                <% end %>
              </div>
            </div>
          </div>
        </nav>

        <main class="flex-1">
          <div class="px-4 py-8 lg:px-8">
            <% if flash[:raw_key] %>
              <div class="p-4 mb-6 bg-yellow-500/10 border border-yellow-500/20 rounded-lg">
                <p class="text-sm font-medium text-yellow-400 mb-2"><%= t("admin.api_keys.raw_key.title") %></p>
                <code class="block p-2 bg-background rounded text-sm font-mono"><%= flash[:raw_key] %></code>
                <p class="text-xs text-muted-foreground mt-2"><%= t("admin.api_keys.raw_key.subtitle") %></p>
              </div>
            <% end %>

            <%= yield %>
          </div>
        </main>

        <%= render "shared/toast" %>
      </div>
    </div>
  </body>
</html>
