<% content_for :title, t("admin.api_keys.index.title") %>

<div class="flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between mb-8">
  <div>
    <h1 class="text-3xl font-bold tracking-tight"><%= t("admin.api_keys.index.title") %></h1>
    <p class="mt-1 text-sm text-muted-foreground"><%= t("admin.api_keys.index.subtitle") %></p>
  </div>

  <div class="flex items-center gap-3">
    <%= render_button t("admin.api_keys.index.create"), as: :link, href: new_admin_api_key_path %>
  </div>
</div>

<%= render_card do %>
  <div class="p-6">
    <% if @api_keys.any? %>
      <div class="overflow-x-auto">
        <%= render_table do %>
          <%= table_head do %>
            <%= table_header t("admin.api_keys.index.table.name") %>
            <%= table_header t("admin.api_keys.index.table.campaign") %>
            <%= table_header t("admin.api_keys.index.table.key_prefix") %>
            <%= table_header t("admin.api_keys.index.table.status") %>
            <%= table_header t("admin.api_keys.index.table.last_used") %>
            <%= table_header t("admin.api_keys.index.table.requests"), class: "text-right" %>
            <%= table_header "", class: "w-0" %>
          <% end %>

          <%= table_body do %>
            <% @api_keys.each do |api_key| %>
              <%= table_row do %>
                <%= table_column class: "font-semibold" do %>
                  <%= api_key.name %>
                <% end %>

                <%= table_column do %>
                  <%= api_key.campaign.name %>
                <% end %>

                <%= table_column do %>
                  <code class="rounded bg-muted px-2 py-1 text-xs"><%= api_key.key_prefix %>...</code>
                <% end %>

                <%= table_column do %>
                  <% if api_key.active? %>
                    <span class="inline-flex items-center rounded-full bg-emerald-500/15 px-2.5 py-1 text-xs font-semibold text-emerald-200">
                      <%= t("admin.api_keys.index.status.active") %>
                    </span>
                  <% else %>
                    <span class="inline-flex items-center rounded-full bg-zinc-500/15 px-2.5 py-1 text-xs font-semibold text-zinc-200">
                      <%= t("admin.api_keys.index.status.inactive") %>
                    </span>
                  <% end %>
                <% end %>

                <%= table_column class: "text-muted-foreground" do %>
                  <% if api_key.last_used_at %>
                    <%= t("admin.api_keys.index.last_used.ago", time: time_ago_in_words(api_key.last_used_at)) %>
                  <% else %>
                    <%= t("admin.api_keys.index.last_used.never") %>
                  <% end %>
                <% end %>

                <%= table_column class: "text-right tabular-nums" do %>
                  <%= number_with_delimiter(api_key.request_count) %>
                <% end %>

                <%= table_column class: "text-right" do %>
                  <% if api_key.active? %>
                    <%= button_to admin_api_key_path(api_key), method: :delete,
                          class: "inline-flex h-9 items-center justify-center rounded-md border border-input bg-background px-3 text-sm font-semibold hover:bg-accent hover:text-accent-foreground",
                          data: { turbo_confirm: t("admin.api_keys.index.revoke.confirm") } do %>
                      <%= t("admin.api_keys.index.revoke.label") %>
                    <% end %>
                  <% end %>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>
      </div>
    <% else %>
      <div class="py-12 text-center">
        <p class="text-lg font-semibold"><%= t("admin.api_keys.index.empty.title") %></p>
        <p class="mt-1 text-sm text-muted-foreground"><%= t("admin.api_keys.index.empty.subtitle") %></p>
      </div>
    <% end %>
  </div>
<% end %>
