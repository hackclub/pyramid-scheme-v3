<% content_for :title, "Edit Asset · #{@campaign.name}" %>

<div class="mb-8">
  <%= link_to "← Back to Assets", admin_campaign_assets_path(@campaign), class: "text-sm text-muted-foreground hover:text-foreground transition-colors" %>
</div>

<div class="max-w-2xl">
  <h1 class="text-3xl font-bold tracking-tight text-foreground mb-8">Edit Asset</h1>

  <%= form_with model: [@campaign, @asset], url: admin_campaign_asset_path(@campaign, @asset), method: :patch, class: "space-y-6" do |f| %>
    <% if @asset.errors.any? %>
      <div class="rounded-lg bg-destructive/10 border border-destructive/20 p-4">
        <h3 class="text-sm font-medium text-destructive">Please fix the following errors:</h3>
        <ul class="mt-2 text-sm text-destructive list-disc list-inside">
          <% @asset.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <% if @asset.file.attached? %>
      <div class="rounded-lg border border-border bg-card p-4">
        <div class="text-sm text-muted-foreground mb-2">Current file</div>
        <% if @asset.file.content_type&.start_with?("image/") %>
          <%= image_tag url_for(@asset.file), class: "max-w-xs rounded" %>
        <% else %>
          <div class="flex items-center gap-2">
            <svg class="w-8 nh-8 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            <span><%= @asset.file.filename %></span>
          </div>
        <% end %>
        <%= link_to "Download", url_for(@asset.file), class: "text-sm text-primary hover:underline mt-2 inline-block", target: "_blank" %>
      </div>
    <% end %>

    <div class="rounded-lg border border-border bg-card shadow-sm p-6 space-y-6">
      <div>
        <%= f.label :asset_type, "Asset Type", class: "block text-sm font-medium mb-2" %>
        <%= f.select :asset_type, CampaignAsset::ASSET_TYPES.map { |t| [t.humanize, t] }, {}, class: "w-full rounded-md border border-input bg-background px-3 py-2 text-sm" %>
      </div>

      <div>
        <%= f.label :name, class: "block text-sm font-medium mb-2" %>
        <%= f.text_field :name, class: "w-full rounded-md border border-input bg-background px-3 py-2 text-sm", placeholder: "Asset name" %>
      </div>

      <div>
        <%= f.label :variant, "Variant (for poster templates)", class: "block text-sm font-medium mb-2" %>
        <%= f.select :variant, [["None", nil]] + CampaignAsset::POSTER_VARIANTS.map { |v| [v.humanize, v] }, {}, class: "w-full rounded-md border border-input bg-background px-3 py-2 text-sm" %>
      </div>

      <div>
        <%= f.label :description, class: "block text-sm font-medium mb-2" %>
        <%= f.text_area :description, rows: 2, class: "w-full rounded-md border border-input bg-background px-3 py-2 text-sm", placeholder: "Optional description..." %>
      </div>

      <div>
        <%= f.label :file, "Replace file (optional)", class: "block text-sm font-medium mb-2" %>
        <%= f.file_field :file, class: "w-full text-sm", accept: ".pdf,.png,.jpg,.jpeg,.webp,.svg,.css,.ico" %>
        <p class="text-xs text-muted-foreground mt-1">Leave empty to keep the current file</p>
      </div>

      <div class="flex items-center gap-3">
        <%= f.check_box :active, class: "rounded border-input" %>
        <%= f.label :active, "Asset is active", class: "text-sm font-medium" %>
      </div>
    </div>

    <div class="flex gap-4">
      <%= f.submit "Update Asset", class: "inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium bg-primary text-primary-foreground hover:bg-primary/90 transition-colors cursor-pointer" %>
      <%= link_to "Cancel", admin_campaign_assets_path(@campaign), class: "inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium border border-border hover:bg-muted transition-colors" %>
    </div>
  <% end %>
</div>
